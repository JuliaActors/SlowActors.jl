<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Integration · SlowActors.jl</title><link rel="canonical" href="https://JuliaActors.github.io/SlowActors.jl/integrate/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">SlowActors.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../api/">API</a></li><li class="is-active"><a class="tocitem" href>Integration</a><ul class="internal"><li><a class="tocitem" href="#Actor-Primitives"><span>Actor Primitives</span></a></li><li><a class="tocitem" href="#Plugin-the-Actors-API"><span>Plugin the <code>Actors</code> API</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Integration</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Integration</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaActors/SlowActors.jl/blob/master/docs/src/integrate.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Integration"><a class="docs-heading-anchor" href="#Integration">Integration</a><a id="Integration-1"></a><a class="docs-heading-anchor-permalink" href="#Integration" title="Permalink"></a></h1><p><code>SlowActors</code> took the following steps to integrate with <code>Actors</code>:</p><h2 id="Actor-Primitives"><a class="docs-heading-anchor" href="#Actor-Primitives">Actor Primitives</a><a id="Actor-Primitives-1"></a><a class="docs-heading-anchor-permalink" href="#Actor-Primitives" title="Permalink"></a></h2><h3 id=".-Reexport-Actors"><a class="docs-heading-anchor" href="#.-Reexport-Actors">1. Reexport <code>Actors</code></a><a id=".-Reexport-Actors-1"></a><a class="docs-heading-anchor-permalink" href="#.-Reexport-Actors" title="Permalink"></a></h3><pre><code class="language-julia">using Reexport
@reexport using Actors</code></pre><h3 id=".-Provide-Yourtype-as-a-Link{T}-parameter"><a class="docs-heading-anchor" href="#.-Provide-Yourtype-as-a-Link{T}-parameter">2. Provide <code>Yourtype</code> as a <code>Link{T}</code> parameter</a><a id=".-Provide-Yourtype-as-a-Link{T}-parameter-1"></a><a class="docs-heading-anchor-permalink" href="#.-Provide-Yourtype-as-a-Link{T}-parameter" title="Permalink"></a></h3><p>I the case of <code>SlowActors</code> this is <code>Mailbox</code>:</p><pre><code class="language-julia">struct Mailbox
    box::Deque
    lock::ReentrantLock
    A::Union{Nothing,SlowActor}
end</code></pre><h3 id=".-Provide-a-concrete-Link-type"><a class="docs-heading-anchor" href="#.-Provide-a-concrete-Link-type">3. Provide a concrete <code>Link</code> type</a><a id=".-Provide-a-concrete-Link-type-1"></a><a class="docs-heading-anchor-permalink" href="#.-Provide-a-concrete-Link-type" title="Permalink"></a></h3><p>You then can create a new concrete <code>Link{Yourtype}</code> type:</p><pre><code class="language-julia">newLink() = Link(Mailbox(Deque{Any}(), ReentrantLock(), nothing),
                 myid(), :local)</code></pre><p>Your actor creation primitive, e.g. <code>spawn</code> must return that type too:</p><pre><code class="language-julia">function spawn(bhv::Func; sticky=false)
    lk = Link(
        Mailbox(Deque{Any}(), ReentrantLock(), 
            SlowActor(nothing, sticky, _ACT())),
        myid(), :local
    )
    lk.chn.A.act.bhv = bhv
    lk.chn.A.act.self = lk
end</code></pre><h3 id=".-Export-your-primitives-for-link-and-actor-creation"><a class="docs-heading-anchor" href="#.-Export-your-primitives-for-link-and-actor-creation">4. Export your primitives for link and actor creation</a><a id=".-Export-your-primitives-for-link-and-actor-creation-1"></a><a class="docs-heading-anchor-permalink" href="#.-Export-your-primitives-for-link-and-actor-creation" title="Permalink"></a></h3><pre><code class="language-julia">export newLink, spawn</code></pre><h3 id=".-Reimplement-send!-for-your-link-type"><a class="docs-heading-anchor" href="#.-Reimplement-send!-for-your-link-type">5. Reimplement <code>send!</code> for your link type</a><a id=".-Reimplement-send!-for-your-link-type-1"></a><a class="docs-heading-anchor-permalink" href="#.-Reimplement-send!-for-your-link-type" title="Permalink"></a></h3><pre><code class="language-julia">Actors.send!(lk::Link{Mailbox}, msg::Msg) = (push!(lk.chn, msg); _start_on_send(lk))
Actors.send!(lk::Link{Mailbox}, msg...) = (push!(lk.chn, msg); _start_on_send(lk))</code></pre><p>Then you can send messages between actors using the <code>Actors</code> interface. Still some further primitives are missing, e.g. <code>self()</code> and <code>become!</code>/<code>become</code>. You get those and much more if you plug in the messaging protocol of <code>Actors</code>.</p><h2 id="Plugin-the-Actors-API"><a class="docs-heading-anchor" href="#Plugin-the-Actors-API">Plugin the <code>Actors</code> API</a><a id="Plugin-the-Actors-API-1"></a><a class="docs-heading-anchor-permalink" href="#Plugin-the-Actors-API" title="Permalink"></a></h2><h3 id=".-Provide-your-actor-with-the-_ACT-variable"><a class="docs-heading-anchor" href="#.-Provide-your-actor-with-the-_ACT-variable">6. Provide your actor with the <code>_ACT</code> variable</a><a id=".-Provide-your-actor-with-the-_ACT-variable-1"></a><a class="docs-heading-anchor-permalink" href="#.-Provide-your-actor-with-the-_ACT-variable" title="Permalink"></a></h3><p>The <code>_ACT</code> variable contains status information for each actor such as the behavior function, the actor link, init and exit functions, actor ties ...</p><p>Therefore on actor creation you create also <code>_ACT()</code>. As shown above, you must set the fields <code>bhv</code> and <code>self</code> with the behavior and the actor link respectively:</p><pre><code class="language-julia">    ...
    lk.chn.A.act.bhv = bhv
    lk.chn.A.act.self = lk
end</code></pre><p>When your actor task starts, it puts a reference to its <code>_ACT</code> variable into <code>task_local_storage</code>:</p><pre><code class="language-julia">function _act(mbx::Mailbox)
    task_local_storage(&quot;_ACT&quot;, mbx.A.act)
    magic = hash(rand(Int))
    while true
        msg = lock(mbx.lock) do 
            isempty(mbx.box) ?
                magic : popfirst!(mbx.box)
        end
        msg == magic &amp;&amp; break
        msg isa Actors.Exit &amp;&amp; break
        onmessage(mbx.A.act, msg)
    end
end</code></pre><h3 id=".-Call-onmessage-to-process-a-message"><a class="docs-heading-anchor" href="#.-Call-onmessage-to-process-a-message">7. Call <code>onmessage</code> to process a message</a><a id=".-Call-onmessage-to-process-a-message-1"></a><a class="docs-heading-anchor-permalink" href="#.-Call-onmessage-to-process-a-message" title="Permalink"></a></h3><p>If a message of type <code>Msg</code> arrives, <code>onmessage</code> provides a finite state machine to process it. To call <code>onmessage(A::_ACT, msg)</code> enables the <code>Actors</code> messaging protocol.</p><p>You can extend <code>Msg</code> with new message types or create other message types. In that case you might want to extend <code>Actors.onmessage</code> to handle those other types if you don&#39;t want the standard behavior to pass it as last argument to the behavior function.</p><h3 id=".-Enable-receive!"><a class="docs-heading-anchor" href="#.-Enable-receive!">8. Enable <code>receive!</code></a><a id=".-Enable-receive!-1"></a><a class="docs-heading-anchor-permalink" href="#.-Enable-receive!" title="Permalink"></a></h3><p>The <code>Actors</code> API works with <code>receive!</code> to enable easy communication with actors. You enable <code>receive!</code> on your concrete link type if you extend three Base functions with your <code>Link{Yourtype}</code> parameter <code>Yourtype</code>, e.g.:</p><pre><code class="language-julia">Base.isready(mbx::Mailbox) = !isempty(mbx)
function Base.fetch(mbx::Mailbox) # this waits for a message
    timedwait(60, pollint=0.01) do 
        !isempty(mbx)
    end == :ok ?
        lock(()-&gt;first(mbx.box), mbx.lock) :
        :timed_out
end
Base.take!(mbx::Mailbox) = popfirst!(mbx)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../api/">« API</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 17 November 2020 08:33">Tuesday 17 November 2020</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
